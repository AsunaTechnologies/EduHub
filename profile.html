<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - Asyl DataHub</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Sora:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <!-- Common Styles -->
    <link rel="stylesheet" href="styles.css">
    
    <style>
        /* Profile Section */
        .profile-section {
            margin-top: 72px;
            padding: 2rem 0 4rem;
            min-height: calc(100vh - 72px);
            background: var(--bg-cream);
        }

        .profile-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* Profile Dashboard */
        .profile-dashboard {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 2rem;
            margin-top: 1rem;
        }

        /* Profile Sidebar */
        .profile-sidebar {
            background: var(--bg-white);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 2rem;
            height: fit-content;
            box-shadow: var(--shadow-soft);
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 1.25rem;
            background: var(--primary-navy);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-gold);
            font-size: 2.5rem;
            font-weight: 700;
            font-family: 'Sora', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-name {
            text-align: center;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: var(--primary-navy);
        }

        .profile-email {
            text-align: center;
            color: var(--text-muted);
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
        }

        .profile-menu {
            list-style: none;
            padding: 0;
            border-top: 1px solid var(--border-light);
            padding-top: 1.5rem;
        }

        .profile-menu li {
            margin-bottom: 0.25rem;
        }

        .profile-menu a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
            font-weight: 500;
        }

        .profile-menu a:hover {
            background: var(--bg-cream);
            color: var(--primary-navy);
        }

        .profile-menu a.active {
            background: var(--primary-navy);
            color: white;
        }

        .profile-menu a i {
            width: 20px;
            text-align: center;
        }

        /* Profile Content */
        .profile-content {
            background: var(--bg-white);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 2rem;
            min-height: 500px;
            box-shadow: var(--shadow-soft);
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-light);
        }

        .section-title {
            font-size: 1.35rem;
            color: var(--primary-navy);
        }

        /* Personal Info Form */
        .personal-info-form {
            max-width: 600px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary-navy);
        }

        .form-input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            font-size: 1rem;
            transition: all var(--transition-fast);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-navy);
            box-shadow: 0 0 0 3px rgba(26, 54, 93, 0.1);
        }

        .form-input.phone-valid {
            border-color: var(--success);
        }

        .form-input.phone-valid:focus {
            border-color: var(--success);
            box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.1);
        }

        .form-input.phone-invalid {
            border-color: var(--error);
        }

        .form-input.phone-invalid:focus {
            border-color: var(--error);
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
        }

        .phone-hint {
            font-size: 0.85rem;
            margin-top: 0.5rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Documents Section */
        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .document-card {
            background: var(--bg-cream);
            border: 2px dashed var(--border-medium);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            text-align: center;
            transition: all var(--transition-normal);
            position: relative;
        }

        .document-card:hover {
            border-color: var(--primary-navy);
            background: var(--bg-white);
        }

        .document-card.has-file {
            border-style: solid;
            border-color: var(--success);
            background: rgba(46, 204, 113, 0.05);
        }

        .document-icon {
            width: 60px;
            height: 60px;
            background: var(--bg-white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.5rem;
            color: var(--primary-navy);
            border: 1px solid var(--border-light);
        }

        .document-card.has-file .document-icon {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        .document-title {
            font-weight: 600;
            color: var(--primary-navy);
            margin-bottom: 0.5rem;
        }

        .document-desc {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        .document-file-name {
            font-size: 0.85rem;
            color: var(--success);
            font-weight: 500;
            margin-bottom: 0.75rem;
            word-break: break-all;
        }

        .document-input {
            display: none;
        }

        .document-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1.25rem;
            background: var(--primary-navy);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all var(--transition-fast);
        }

        .document-btn:hover {
            background: var(--primary-navy-light);
            transform: translateY(-2px);
        }

        .document-btn.remove-btn {
            background: var(--error);
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        .document-btn.remove-btn:hover {
            background: #c0392b;
        }

        .file-formats {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.75rem;
        }

        /* Send to University Button */
        .send-documents-section {
            background: linear-gradient(135deg, var(--primary-navy) 0%, #2c5282 100%);
            border-radius: var(--radius-lg);
            padding: 2rem;
            text-align: center;
            color: white;
            margin-top: 2rem;
        }

        .send-documents-section h3 {
            font-size: 1.5rem;
            margin-bottom: 0.75rem;
        }

        .send-documents-section p {
            opacity: 0.9;
            margin-bottom: 1.5rem;
        }

        .send-btn-large {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 2.5rem;
            background: var(--accent-gold);
            color: var(--primary-navy);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all var(--transition-normal);
        }

        .send-btn-large:hover {
            background: #d4a912;
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(201, 162, 39, 0.3);
        }

        .send-btn-large:disabled {
            background: #ccc;
            color: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Bookmarked Universities */
        .bookmarked-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .bookmarked-card {
            background: var(--bg-cream);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            transition: all var(--transition-normal);
        }

        .bookmarked-card:hover {
            border-color: var(--primary-navy);
            box-shadow: var(--shadow-soft);
        }

        .bookmarked-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .bookmarked-uni-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-navy);
            margin-bottom: 0.25rem;
        }

        .bookmarked-uni-location {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .remove-bookmark-btn {
            background: none;
            border: none;
            color: var(--error);
            cursor: pointer;
            font-size: 1.25rem;
            padding: 0.25rem;
            transition: all var(--transition-fast);
        }

        .remove-bookmark-btn:hover {
            transform: scale(1.2);
        }

        .bookmarked-card-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .bookmarked-stat {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .bookmarked-stat i {
            color: var(--accent-gold);
            margin-right: 0.25rem;
        }

        .bookmarked-card-actions {
            display: flex;
            gap: 0.75rem;
        }

        .bookmarked-card-actions .btn {
            flex: 1;
            text-align: center;
            padding: 0.625rem 1rem;
            font-size: 0.9rem;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            background: var(--bg-cream);
            border-radius: var(--radius-lg);
        }

        .empty-state i {
            font-size: 4rem;
            color: var(--text-muted);
            margin-bottom: 1.5rem;
        }

        .empty-state h3 {
            color: var(--primary-navy);
            margin-bottom: 0.75rem;
            font-size: 1.5rem;
        }

        .empty-state p {
            color: var(--text-muted);
            margin-bottom: 1.5rem;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-white);
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 550px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--shadow-heavy);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border-light);
        }

        .modal-header h2 {
            color: var(--primary-navy);
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .modal-header p {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .modal-close:hover {
            color: var(--error);
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-footer {
            padding: 1.5rem 2rem;
            background: var(--bg-cream);
            border-top: 1px solid var(--border-light);
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        /* University Selection in Modal */
        .university-select-list {
            max-height: 250px;
            overflow-y: auto;
            margin-bottom: 1.5rem;
        }

        .university-select-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-cream);
            border: 2px solid var(--border-light);
            border-radius: var(--radius-md);
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .university-select-item:hover {
            border-color: var(--primary-navy);
        }

        .university-select-item.selected {
            border-color: var(--primary-navy);
            background: rgba(26, 54, 93, 0.05);
        }

        .university-select-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: var(--primary-navy);
        }

        .university-select-info {
            flex: 1;
        }

        .university-select-name {
            font-weight: 600;
            color: var(--primary-navy);
            margin-bottom: 0.25rem;
        }

        .university-select-location {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* Success Message */
        .success-message {
            text-align: center;
            padding: 2rem;
        }

        .success-icon {
            width: 80px;
            height: 80px;
            background: var(--success);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-size: 2.5rem;
            color: white;
        }

        .success-message h3 {
            color: var(--primary-navy);
            font-size: 1.5rem;
            margin-bottom: 0.75rem;
        }

        .success-message p {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-cream);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            text-align: center;
        }

        .stat-card .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-navy);
            margin-bottom: 0.25rem;
        }

        .stat-card .stat-label {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        /* Sync Notification Animations */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .sync-notification i {
            font-size: 1.1rem;
        }

        /* Phone Input Validation Styles */
        .form-input.phone-valid {
            border-color: var(--success);
            background: rgba(46, 204, 113, 0.05);
        }

        .form-input.phone-invalid {
            border-color: var(--error);
            background: rgba(231, 76, 60, 0.05);
        }

        .phone-hint {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        /* Cloud Sync Badge */
        .cloud-sync-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.35rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .cloud-sync-badge i {
            font-size: 0.7rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .profile-section {
                margin-top: 120px;
            }

            .profile-dashboard {
                grid-template-columns: 1fr;
            }

            .documents-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .bookmarked-grid {
                grid-template-columns: 1fr;
            }

            .modal-footer {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <span class="logo-icon">Asyl</span>DataHub
            </a>
            
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link" data-i18n="nav.home">Home</a></li>
                <li><a href="study-in-kazakhstan.html" class="nav-link" data-i18n="nav.studyKz">Study in Kazakhstan</a></li>
                <li><a href="dual-diploma.html" class="nav-link" data-i18n="nav.dualDiploma">Double Degree</a></li>
                <li><a href="compare.html" class="nav-link" data-i18n="nav.compare">Compare</a></li>
                <li><a href="edu-helper.html" class="nav-link" data-i18n="nav.eduHelper">Edu Helper</a></li>
                <li><a href="pricing.html" class="nav-link" data-i18n="nav.pricing">Pricing</a></li>
                <li><a href="contact.html" class="nav-link" data-i18n="nav.contact">Contact</a></li>
            </ul>

            <div class="lang-switcher">
                <button class="lang-btn active" data-lang="en" onclick="window.assylDataHub?.switchLanguage('en')">EN</button>
                <button class="lang-btn" data-lang="ru" onclick="window.assylDataHub?.switchLanguage('ru')">RU</button>
                <button class="lang-btn" data-lang="kz" onclick="window.assylDataHub?.switchLanguage('kz')">KZ</button>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1 class="page-title">My <span class="page-title-accent" data-i18n="profile.title">Profile</span></h1>
            <p class="page-subtitle" data-i18n="profile.subtitle">
                Manage your documents, saved universities, and send applications.
            </p>
        </div>
    </section>

    <!-- Profile Section -->
    <section class="profile-section">
        <div class="profile-container">
            <!-- Profile Dashboard -->
            <div class="profile-dashboard">
                <!-- Profile Sidebar -->
                <div class="profile-sidebar">
                    <div class="profile-avatar" id="profileAvatar">U</div>
                    <h3 class="profile-name" id="profileName" data-i18n="profile.guestUser">Guest User</h3>
                    <p class="profile-email" id="profileEmail">Enter your details below</p>

                    <ul class="profile-menu">
                        <li><a href="#" class="active" data-section="personal"><i class="fas fa-user"></i> <span data-i18n="profile.personalInfo">Personal Info</span></a></li>
                        <li><a href="#" data-section="documents"><i class="fas fa-file-alt"></i> <span data-i18n="profile.documents">Documents</span></a></li>
                        <li><a href="#" data-section="bookmarks"><i class="fas fa-bookmark"></i> <span data-i18n="profile.bookmarks">Bookmarked Universities</span></a></li>
                        <li><a href="#" data-section="applications"><i class="fas fa-paper-plane"></i> <span data-i18n="profile.sentApplications">Sent Applications</span></a></li>
                    </ul>
                </div>

                <!-- Profile Content -->
                <div class="profile-content">
                    <!-- Personal Info Section -->
                    <div class="content-section active" id="personal">
                        <div class="section-header">
                            <h2 class="section-title" data-i18n="profile.personalInfo">Personal Information</h2>
                            <button class="btn btn-primary btn-small" onclick="savePersonalInfo()">
                                <i class="fas fa-save"></i> <span data-i18n="profile.save">Save</span>
                            </button>
                        </div>

                        <form class="personal-info-form" id="personalInfoForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" data-i18n="profile.firstName">First Name</label>
                                    <input type="text" class="form-input" id="firstName" placeholder="Enter first name">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" data-i18n="profile.lastName">Last Name</label>
                                    <input type="text" class="form-input" id="lastName" placeholder="Enter last name">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="profile.email">Email Address</label>
                                <input type="email" class="form-input" id="email" placeholder="your@email.com">
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="profile.phone">Phone Number <span class="cloud-sync-badge"><i class="fas fa-cloud"></i> Cloud Sync</span></label>
                                <input type="tel" class="form-input" id="phone" placeholder="+7 747 403 9869">
                                <p class="phone-hint" id="phoneHint">Enter your phone to sync data across devices</p>
                            </div>
                        </form>

                        <div class="stats-grid" style="margin-top: 2rem;">
                            <div class="stat-card">
                                <div class="stat-value" id="docCount">0</div>
                                <div class="stat-label" data-i18n="profile.documentsUploaded">Documents Uploaded</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="bookmarkCount">0</div>
                                <div class="stat-label" data-i18n="profile.universitiesBookmarked">Universities Bookmarked</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="appCount">0</div>
                                <div class="stat-label" data-i18n="profile.applicationsSent">Applications Sent</div>
                            </div>
                        </div>
                    </div>

                    <!-- Documents Section -->
                    <div class="content-section" id="documents">
                        <div class="section-header">
                            <h2 class="section-title" data-i18n="profile.myDocuments">My Documents</h2>
                        </div>

                        <div class="documents-grid">
                            <!-- IELTS Certificate -->
                            <div class="document-card" id="ieltsCard">
                                <div class="document-icon">
                                    <i class="fas fa-language"></i>
                                </div>
                                <h4 class="document-title" data-i18n="profile.ieltsCert">IELTS Certificate</h4>
                                <p class="document-desc" data-i18n="profile.ieltsDesc">Upload your IELTS test results</p>
                                <div class="document-file-name" id="ieltsFileName" style="display: none;"></div>
                                <input type="file" class="document-input" id="ieltsInput" accept=".png,.jpg,.jpeg,.docx,.pdf" onchange="handleFileUpload('ielts', this)">
                                <button class="document-btn" onclick="document.getElementById('ieltsInput').click()">
                                    <i class="fas fa-upload"></i> <span data-i18n="profile.upload">Upload</span>
                                </button>
                                <button class="document-btn remove-btn" id="ieltsRemove" style="display: none; margin-left: 0.5rem;" onclick="removeFile('ielts')">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <p class="file-formats">PNG, JPG, DOCX, PDF</p>
                            </div>

                            <!-- School Transcript -->
                            <div class="document-card" id="transcriptCard">
                                <div class="document-icon">
                                    <i class="fas fa-scroll"></i>
                                </div>
                                <h4 class="document-title" data-i18n="profile.transcript">School Transcript</h4>
                                <p class="document-desc" data-i18n="profile.transcriptDesc">Upload your academic transcript</p>
                                <div class="document-file-name" id="transcriptFileName" style="display: none;"></div>
                                <input type="file" class="document-input" id="transcriptInput" accept=".png,.jpg,.jpeg,.docx,.pdf" onchange="handleFileUpload('transcript', this)">
                                <button class="document-btn" onclick="document.getElementById('transcriptInput').click()">
                                    <i class="fas fa-upload"></i> <span data-i18n="profile.upload">Upload</span>
                                </button>
                                <button class="document-btn remove-btn" id="transcriptRemove" style="display: none; margin-left: 0.5rem;" onclick="removeFile('transcript')">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <p class="file-formats">PNG, JPG, DOCX, PDF</p>
                            </div>

                            <!-- Recommendation Letter -->
                            <div class="document-card" id="recommendationCard">
                                <div class="document-icon">
                                    <i class="fas fa-envelope-open-text"></i>
                                </div>
                                <h4 class="document-title" data-i18n="profile.recommendation">Recommendation Letter</h4>
                                <p class="document-desc" data-i18n="profile.recommendationDesc">Upload recommendation from teacher</p>
                                <div class="document-file-name" id="recommendationFileName" style="display: none;"></div>
                                <input type="file" class="document-input" id="recommendationInput" accept=".png,.jpg,.jpeg,.docx,.pdf" onchange="handleFileUpload('recommendation', this)">
                                <button class="document-btn" onclick="document.getElementById('recommendationInput').click()">
                                    <i class="fas fa-upload"></i> <span data-i18n="profile.upload">Upload</span>
                                </button>
                                <button class="document-btn remove-btn" id="recommendationRemove" style="display: none; margin-left: 0.5rem;" onclick="removeFile('recommendation')">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <p class="file-formats">PNG, JPG, DOCX, PDF</p>
                            </div>

                            <!-- UNE/ENT Certificate -->
                            <div class="document-card" id="entCard">
                                <div class="document-icon">
                                    <i class="fas fa-graduation-cap"></i>
                                </div>
                                <h4 class="document-title" data-i18n="profile.entCert">UNE/ENT Certificate</h4>
                                <p class="document-desc" data-i18n="profile.entDesc">Kazakhstan national exam results</p>
                                <div class="document-file-name" id="entFileName" style="display: none;"></div>
                                <input type="file" class="document-input" id="entInput" accept=".png,.jpg,.jpeg,.docx,.pdf" onchange="handleFileUpload('ent', this)">
                                <button class="document-btn" onclick="document.getElementById('entInput').click()">
                                    <i class="fas fa-upload"></i> <span data-i18n="profile.upload">Upload</span>
                                </button>
                                <button class="document-btn remove-btn" id="entRemove" style="display: none; margin-left: 0.5rem;" onclick="removeFile('ent')">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <p class="file-formats">PNG, JPG, DOCX, PDF</p>
                            </div>

                            <!-- SAT Certificate -->
                            <div class="document-card" id="satCard">
                                <div class="document-icon">
                                    <i class="fas fa-award"></i>
                                </div>
                                <h4 class="document-title" data-i18n="profile.satCert">SAT Certificate</h4>
                                <p class="document-desc" data-i18n="profile.satDesc">Upload your SAT score report</p>
                                <div class="document-file-name" id="satFileName" style="display: none;"></div>
                                <input type="file" class="document-input" id="satInput" accept=".png,.jpg,.jpeg,.docx,.pdf" onchange="handleFileUpload('sat', this)">
                                <button class="document-btn" onclick="document.getElementById('satInput').click()">
                                    <i class="fas fa-upload"></i> <span data-i18n="profile.upload">Upload</span>
                                </button>
                                <button class="document-btn remove-btn" id="satRemove" style="display: none; margin-left: 0.5rem;" onclick="removeFile('sat')">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <p class="file-formats">PNG, JPG, DOCX, PDF</p>
                            </div>
                        </div>

                        <!-- Send to University Section -->
                        <div class="send-documents-section">
                            <h3 data-i18n="profile.readyToApply">Ready to Apply?</h3>
                            <p data-i18n="profile.sendDocsDesc">Send your documents to your bookmarked universities. We'll notify you when they start accepting applications.</p>
                            <button class="send-btn-large" id="sendToUniBtn" onclick="openSendModal()">
                                <i class="fas fa-paper-plane"></i> <span data-i18n="profile.sendToUniversity">Send to University</span>
                            </button>
                        </div>
                    </div>

                    <!-- Bookmarked Universities Section -->
                    <div class="content-section" id="bookmarks">
                        <div class="section-header">
                            <h2 class="section-title" data-i18n="profile.bookmarkedUniversities">Bookmarked Universities</h2>
                            <a href="study-in-kazakhstan.html" class="btn btn-primary btn-small">
                                <i class="fas fa-plus"></i> <span data-i18n="profile.addMore">Add More</span>
                            </a>
                        </div>

                        <div class="bookmarked-grid" id="bookmarkedGrid">
                            <!-- Dynamic content will be loaded here -->
                        </div>

                        <div class="empty-state" id="emptyBookmarks" style="display: none;">
                            <i class="fas fa-bookmark"></i>
                            <h3 data-i18n="profile.noBookmarks">No Bookmarked Universities</h3>
                            <p data-i18n="profile.noBookmarksDesc">Start exploring universities and bookmark your favorites to track them here.</p>
                            <a href="study-in-kazakhstan.html" class="btn btn-primary" data-i18n="profile.exploreNow">Explore Universities</a>
                        </div>
                    </div>

                    <!-- Sent Applications Section -->
                    <div class="content-section" id="applications">
                        <div class="section-header">
                            <h2 class="section-title" data-i18n="profile.sentApplications">Sent Applications</h2>
                        </div>

                        <div id="applicationsList">
                            <!-- Dynamic content -->
                        </div>

                        <div class="empty-state" id="emptyApplications">
                            <i class="fas fa-paper-plane"></i>
                            <h3 data-i18n="profile.noApplications">No Applications Sent Yet</h3>
                            <p data-i18n="profile.noApplicationsDesc">Upload your documents and send them to your bookmarked universities.</p>
                            <button class="btn btn-primary" onclick="switchToSection('documents')" data-i18n="profile.uploadDocs">Upload Documents</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Send to University Modal -->
    <div class="modal" id="sendModal">
        <div class="modal-content" style="position: relative;">
            <button class="modal-close" onclick="closeSendModal()">&times;</button>
            
            <!-- Step 1: Select Universities -->
            <div id="sendStep1">
                <div class="modal-header">
                    <h2 data-i18n="profile.selectUniversities">Select Universities</h2>
                    <p data-i18n="profile.selectUnisDesc">Choose which universities to send your documents to</p>
                </div>
                <div class="modal-body">
                    <div class="university-select-list" id="universitySelectList">
                        <!-- Dynamic content -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeSendModal()" data-i18n="profile.cancel">Cancel</button>
                    <button class="btn btn-primary" onclick="goToStep2()" data-i18n="profile.next">Next</button>
                </div>
            </div>

            <!-- Step 2: Confirm & Email -->
            <div id="sendStep2" style="display: none;">
                <div class="modal-header">
                    <h2 data-i18n="profile.confirmSend">Confirm & Send</h2>
                    <p data-i18n="profile.confirmDesc">Enter your email to receive confirmation</p>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label" data-i18n="profile.yourEmail">Your Email</label>
                        <input type="email" class="form-input" id="confirmEmail" placeholder="your@email.com">
                    </div>
                    <div style="background: var(--bg-cream); padding: 1rem; border-radius: var(--radius-md); margin-top: 1rem;">
                        <p style="font-size: 0.9rem; color: var(--text-secondary);">
                            <i class="fas fa-info-circle" style="color: var(--accent-gold); margin-right: 0.5rem;"></i>
                            <span data-i18n="profile.notificationNote">You will receive a notification when universities start accepting documents.</span>
                        </p>
                    </div>
                    <div style="margin-top: 1rem;">
                        <strong data-i18n="profile.selectedUnisLabel">Selected Universities:</strong>
                        <div id="selectedUnisList" style="margin-top: 0.5rem;"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="goToStep1()" data-i18n="profile.back">Back</button>
                    <button class="btn btn-primary" onclick="submitApplication()" data-i18n="profile.sendApplication">Send Application</button>
                </div>
            </div>

            <!-- Step 3: Success -->
            <div id="sendStep3" style="display: none;">
                <div class="modal-body">
                    <div class="success-message">
                        <div class="success-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <h3 data-i18n="profile.applicationSubmitted">Application Submitted!</h3>
                        <p data-i18n="profile.successMessage">Your documents have been queued. You will receive an email notification at <strong id="confirmedEmail"></strong> when universities start accepting applications.</p>
                        <button class="btn btn-primary" onclick="closeSendModal()" data-i18n="profile.done">Done</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content footer-grid">
                <div class="footer-section footer-brand">
                    <h4>Asyl DataHub</h4>
                    <p data-i18n="footer.about">Empowering students and families to make informed decisions about higher education.</p>
                </div>
                <div class="footer-section">
                    <h4 data-i18n="footer.quickLinks">Quick Links</h4>
                    <ul>
                        <li><a href="study-in-kazakhstan.html" data-i18n="nav.studyKz">Study in Kazakhstan</a></li>
                        <li><a href="dual-diploma.html" data-i18n="nav.dualDiploma">Double Degree</a></li>
                        <li><a href="pricing.html" data-i18n="nav.pricing">Our Services</a></li>
                        <li><a href="contact.html" data-i18n="nav.contact">Contact Us</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4 data-i18n="footer.contact">Contact</h4>
                    <ul>
                        <li><i class="fas fa-envelope"></i> abulkasimovbahtiar3@gmail.com</li>
                        <li><i class="fas fa-phone"></i> +7 (747) 403-9869</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p data-i18n="footer.copyright">&copy; 2025 Asyl DataHub. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Main JavaScript -->
    <script src="main.js"></script>
    <!-- User API -->
    <script src="api/user.js"></script>
    
    <script>
        // Document storage
        let uploadedDocuments = JSON.parse(localStorage.getItem('uploadedDocuments')) || {};
        let bookmarkedUniversities = JSON.parse(localStorage.getItem('bookmarkedUniversities')) || [];
        let sentApplications = JSON.parse(localStorage.getItem('sentApplications')) || [];
        let selectedUnisForSend = [];
        let isSyncing = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            await loadPersonalInfo();
            loadDocuments();
            loadBookmarks();
            loadApplications();
            updateStats();

            // Profile menu functionality
            const menuLinks = document.querySelectorAll('.profile-menu a');
            const contentSections = document.querySelectorAll('.content-section');

            menuLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const sectionId = this.dataset.section;
                    switchToSection(sectionId);
                });
            });

            // Add phone input listener for auto-load and validation
            const phoneInput = document.getElementById('phone');
            const phoneHint = document.getElementById('phoneHint');
            let phoneDebounceTimer;
            
            phoneInput.addEventListener('input', function() {
                const phone = this.value;
                clearTimeout(phoneDebounceTimer);
                
                // Real-time validation styling
                if (phone.length > 5) {
                    if (window.UserAPI && window.UserAPI.isValidPhoneNumber(phone)) {
                        this.classList.remove('phone-invalid');
                        this.classList.add('phone-valid');
                        phoneHint.textContent = 'âœ“ Valid phone number';
                        phoneHint.style.color = 'var(--success)';
                    } else {
                        this.classList.remove('phone-valid');
                        this.classList.add('phone-invalid');
                        phoneHint.textContent = 'Format: +7 XXX XXX XXXX';
                        phoneHint.style.color = 'var(--error)';
                    }
                } else {
                    this.classList.remove('phone-valid', 'phone-invalid');
                    phoneHint.textContent = 'Enter your phone to sync data across devices';
                    phoneHint.style.color = 'var(--text-muted)';
                }

                // Debounced backend check
                phoneDebounceTimer = setTimeout(async () => {
                    if (window.UserAPI && window.UserAPI.isValidPhoneNumber(phone)) {
                        await tryLoadUserFromBackend(phone);
                    }
                }, 1000); // Wait 1 second after typing stops
            });
        });

        function switchToSection(sectionId) {
            const menuLinks = document.querySelectorAll('.profile-menu a');
            const contentSections = document.querySelectorAll('.content-section');

            menuLinks.forEach(l => {
                l.classList.remove('active');
                if (l.dataset.section === sectionId) {
                    l.classList.add('active');
                }
            });

            contentSections.forEach(section => {
                section.classList.remove('active');
                if (section.id === sectionId) {
                    section.classList.add('active');
                }
            });
        }

        // Try to load user data from backend
        async function tryLoadUserFromBackend(phone) {
            if (!window.UserAPI || isSyncing) return false;
            
            try {
                showSyncStatus('loading', 'Loading your profile...');
                const userData = await window.UserAPI.getUserByPhone(phone);
                
                if (userData) {
                    // User found - populate fields from backend
                    if (userData.firstName) document.getElementById('firstName').value = userData.firstName;
                    if (userData.lastName) document.getElementById('lastName').value = userData.lastName;
                    if (userData.email) document.getElementById('email').value = userData.email;
                    
                    // Update localStorage
                    const info = {
                        firstName: userData.firstName || '',
                        lastName: userData.lastName || '',
                        email: userData.email || '',
                        phone: userData.phoneNumber || phone
                    };
                    localStorage.setItem('personalInfo', JSON.stringify(info));
                    updateProfileDisplay(info);
                    
                    // Restore documents
                    if (userData.documents && Object.keys(userData.documents).length > 0) {
                        Object.entries(userData.documents).forEach(([type, data]) => {
                            uploadedDocuments[type] = {
                                name: data.fileName,
                                url: data.url,
                                uploadedAt: data.uploadedAt
                            };
                        });
                        localStorage.setItem('uploadedDocuments', JSON.stringify(uploadedDocuments));
                        loadDocuments();
                    }
                    
                    // Restore bookmarked universities
                    if (userData.bookmarkedUniversities && userData.bookmarkedUniversities.length > 0) {
                        bookmarkedUniversities = userData.bookmarkedUniversities;
                        localStorage.setItem('bookmarkedUniversities', JSON.stringify(bookmarkedUniversities));
                        loadBookmarks();
                    }
                    
                    // Restore sent applications
                    if (userData.sentApplications && userData.sentApplications.length > 0) {
                        sentApplications = userData.sentApplications;
                        localStorage.setItem('sentApplications', JSON.stringify(sentApplications));
                        loadApplications();
                    }
                    
                    updateStats();
                    showSyncStatus('success', 'Profile loaded from cloud!');
                    return true;
                } else {
                    showSyncStatus('info', 'New user - data will be saved to cloud');
                    return false;
                }
            } catch (error) {
                console.error('Error loading from backend:', error);
                showSyncStatus('error', 'Could not connect to server');
                return false;
            }
        }

        // Show sync status notification
        function showSyncStatus(type, message) {
            const existing = document.querySelector('.sync-notification');
            if (existing) existing.remove();

            const notification = document.createElement('div');
            notification.className = 'sync-notification';
            
            const icons = {
                loading: '<i class="fas fa-spinner fa-spin"></i>',
                success: '<i class="fas fa-cloud-download-alt"></i>',
                error: '<i class="fas fa-exclamation-circle"></i>',
                info: '<i class="fas fa-info-circle"></i>',
                saving: '<i class="fas fa-cloud-upload-alt"></i>'
            };
            
            const colors = {
                loading: '#3498db',
                success: '#27ae60',
                error: '#e74c3c',
                info: '#f39c12',
                saving: '#9b59b6'
            };

            notification.innerHTML = `${icons[type] || icons.info} ${message}`;
            notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: ${colors[type] || colors.info};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                display: flex;
                align-items: center;
                gap: 0.75rem;
                font-weight: 500;
                box-shadow: 0 4px 20px rgba(0,0,0,0.2);
                z-index: 9999;
                animation: slideInRight 0.3s ease-out;
            `;

            document.body.appendChild(notification);

            if (type !== 'loading' && type !== 'saving') {
                setTimeout(() => {
                    notification.style.animation = 'slideOutRight 0.3s ease-out forwards';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }
        }

        // Personal Info
        async function loadPersonalInfo() {
            const info = JSON.parse(localStorage.getItem('personalInfo')) || {};
            if (info.firstName) document.getElementById('firstName').value = info.firstName;
            if (info.lastName) document.getElementById('lastName').value = info.lastName;
            if (info.email) document.getElementById('email').value = info.email;
            if (info.phone) document.getElementById('phone').value = info.phone;

            updateProfileDisplay(info);

            // Try to load from backend if phone exists
            if (info.phone && window.UserAPI && window.UserAPI.isValidPhoneNumber(info.phone)) {
                await tryLoadUserFromBackend(info.phone);
            }
        }

        async function savePersonalInfo() {
            const info = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value
            };
            
            // Validate phone number
            if (!info.phone) {
                alert('Please enter your phone number to save your profile.');
                document.getElementById('phone').focus();
                return;
            }

            if (window.UserAPI && !window.UserAPI.isValidPhoneNumber(info.phone)) {
                alert('Please enter a valid phone number (e.g., +7 747 403 9869)');
                document.getElementById('phone').focus();
                return;
            }

            localStorage.setItem('personalInfo', JSON.stringify(info));
            updateProfileDisplay(info);

            // Sync to backend
            if (window.UserAPI) {
                await syncToBackend();
            } else {
                alert('Personal information saved locally!');
            }
        }

        // Sync all data to backend
        async function syncToBackend() {
            if (!window.UserAPI || isSyncing) return;
            
            isSyncing = true;
            showSyncStatus('saving', 'Saving to cloud...');

            try {
                const result = await window.UserAPI.syncToBackend();
                showSyncStatus('success', 'Profile saved to cloud!');
                console.log('Sync successful:', result);
            } catch (error) {
                console.error('Sync failed:', error);
                showSyncStatus('error', 'Save failed - data saved locally');
            } finally {
                isSyncing = false;
            }
        }

        function updateProfileDisplay(info) {
            const name = [info.firstName, info.lastName].filter(Boolean).join(' ') || 'Guest User';
            document.getElementById('profileName').textContent = name;
            document.getElementById('profileAvatar').textContent = (info.firstName || 'U')[0].toUpperCase();
            if (info.email) {
                document.getElementById('profileEmail').textContent = info.email;
            }
        }

        // Document Upload
        async function handleFileUpload(docType, input) {
            const file = input.files[0];
            if (!file) return;

            const validTypes = ['image/png', 'image/jpeg', 'image/jpg', 'application/pdf', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
            if (!validTypes.includes(file.type)) {
                alert('Please upload PNG, JPG, PDF, or DOCX files only.');
                return;
            }

            // Store file info (in real app, you'd upload to server/S3)
            uploadedDocuments[docType] = {
                name: file.name,
                type: file.type,
                size: file.size,
                uploadedAt: new Date().toISOString(),
                url: `local://${file.name}` // In production, this would be S3 URL
            };
            localStorage.setItem('uploadedDocuments', JSON.stringify(uploadedDocuments));

            // Update UI
            const card = document.getElementById(docType + 'Card');
            const fileName = document.getElementById(docType + 'FileName');
            const removeBtn = document.getElementById(docType + 'Remove');

            card.classList.add('has-file');
            fileName.textContent = file.name;
            fileName.style.display = 'block';
            removeBtn.style.display = 'inline-flex';

            updateStats();

            // Sync to backend if user has valid phone
            const info = JSON.parse(localStorage.getItem('personalInfo') || '{}');
            if (info.phone && window.UserAPI && window.UserAPI.isValidPhoneNumber(info.phone)) {
                await syncToBackend();
            }
        }

        async function removeFile(docType) {
            delete uploadedDocuments[docType];
            localStorage.setItem('uploadedDocuments', JSON.stringify(uploadedDocuments));

            const card = document.getElementById(docType + 'Card');
            const fileName = document.getElementById(docType + 'FileName');
            const removeBtn = document.getElementById(docType + 'Remove');
            const input = document.getElementById(docType + 'Input');

            card.classList.remove('has-file');
            fileName.style.display = 'none';
            removeBtn.style.display = 'none';
            input.value = '';

            updateStats();

            // Sync to backend
            const info = JSON.parse(localStorage.getItem('personalInfo') || '{}');
            if (info.phone && window.UserAPI && window.UserAPI.isValidPhoneNumber(info.phone)) {
                await syncToBackend();
            }
        }

        function loadDocuments() {
            Object.keys(uploadedDocuments).forEach(docType => {
                const doc = uploadedDocuments[docType];
                const card = document.getElementById(docType + 'Card');
                const fileName = document.getElementById(docType + 'FileName');
                const removeBtn = document.getElementById(docType + 'Remove');

                if (card && doc) {
                    card.classList.add('has-file');
                    fileName.textContent = doc.name;
                    fileName.style.display = 'block';
                    removeBtn.style.display = 'inline-flex';
                }
            });
        }

        // Bookmarks
        function loadBookmarks() {
            const grid = document.getElementById('bookmarkedGrid');
            const emptyState = document.getElementById('emptyBookmarks');

            if (bookmarkedUniversities.length === 0) {
                grid.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            grid.style.display = 'grid';
            emptyState.style.display = 'none';

            grid.innerHTML = bookmarkedUniversities.map(uni => `
                <div class="bookmarked-card" data-uni-id="${uni.id}">
                    <div class="bookmarked-card-header">
                        <div>
                            <h4 class="bookmarked-uni-name">${uni.name}</h4>
                            <p class="bookmarked-uni-location"><i class="fas fa-map-marker-alt"></i> ${uni.location}</p>
                        </div>
                        <button class="remove-bookmark-btn" onclick="removeBookmark('${uni.id}')">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="bookmarked-card-stats">
                        <span class="bookmarked-stat"><i class="fas fa-trophy"></i> ${uni.ranking || 'N/A'}</span>
                        <span class="bookmarked-stat"><i class="fas fa-users"></i> ${uni.students || 'N/A'}</span>
                    </div>
                    <div class="bookmarked-card-actions">
                        <a href="study-in-kazakhstan.html" class="btn btn-secondary">View Details</a>
                        <button class="btn btn-primary" onclick="quickSendToUni('${uni.id}')">Send Docs</button>
                    </div>
                </div>
            `).join('');
        }

        async function removeBookmark(uniId) {
            bookmarkedUniversities = bookmarkedUniversities.filter(u => u.id !== uniId);
            localStorage.setItem('bookmarkedUniversities', JSON.stringify(bookmarkedUniversities));
            loadBookmarks();
            updateStats();

            // Sync to backend
            const info = JSON.parse(localStorage.getItem('personalInfo') || '{}');
            if (info.phone && window.UserAPI && window.UserAPI.isValidPhoneNumber(info.phone)) {
                await syncToBackend();
            }
        }

        // Applications
        function loadApplications() {
            const list = document.getElementById('applicationsList');
            const emptyState = document.getElementById('emptyApplications');

            if (sentApplications.length === 0) {
                list.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            list.innerHTML = sentApplications.map(app => `
                <div class="bookmarked-card" style="margin-bottom: 1rem;">
                    <div class="bookmarked-card-header">
                        <div>
                            <h4 class="bookmarked-uni-name">${app.universityName}</h4>
                            <p class="bookmarked-uni-location"><i class="fas fa-calendar"></i> Submitted: ${new Date(app.submittedAt).toLocaleDateString()}</p>
                        </div>
                        <span style="background: var(--accent-gold); color: var(--primary-navy); padding: 0.25rem 0.75rem; border-radius: 50px; font-size: 0.8rem; font-weight: 600;">
                            ${app.status}
                        </span>
                    </div>
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-top: 0.5rem;">
                        <i class="fas fa-envelope" style="color: var(--accent-gold);"></i> Confirmation sent to: ${app.email}
                    </p>
                </div>
            `).join('');
        }

        // Stats
        function updateStats() {
            document.getElementById('docCount').textContent = Object.keys(uploadedDocuments).length;
            document.getElementById('bookmarkCount').textContent = bookmarkedUniversities.length;
            document.getElementById('appCount').textContent = sentApplications.length;
        }

        // Send Modal
        function openSendModal() {
            if (bookmarkedUniversities.length === 0) {
                alert('Please bookmark some universities first!');
                switchToSection('bookmarks');
                return;
            }

            if (Object.keys(uploadedDocuments).length === 0) {
                alert('Please upload at least one document first!');
                return;
            }

            selectedUnisForSend = [];
            document.getElementById('sendModal').classList.add('active');
            document.getElementById('sendStep1').style.display = 'block';
            document.getElementById('sendStep2').style.display = 'none';
            document.getElementById('sendStep3').style.display = 'none';

            // Populate university list
            const list = document.getElementById('universitySelectList');
            list.innerHTML = bookmarkedUniversities.map(uni => `
                <label class="university-select-item" data-uni-id="${uni.id}">
                    <input type="checkbox" onchange="toggleUniSelection('${uni.id}', '${uni.name}')">
                    <div class="university-select-info">
                        <div class="university-select-name">${uni.name}</div>
                        <div class="university-select-location">${uni.location}</div>
                    </div>
                </label>
            `).join('');

            // Pre-fill email
            const personalInfo = JSON.parse(localStorage.getItem('personalInfo')) || {};
            if (personalInfo.email) {
                document.getElementById('confirmEmail').value = personalInfo.email;
            }
        }

        function closeSendModal() {
            document.getElementById('sendModal').classList.remove('active');
        }

        function toggleUniSelection(uniId, uniName) {
            const index = selectedUnisForSend.findIndex(u => u.id === uniId);
            if (index > -1) {
                selectedUnisForSend.splice(index, 1);
            } else {
                selectedUnisForSend.push({ id: uniId, name: uniName });
            }

            // Update visual selection
            document.querySelectorAll('.university-select-item').forEach(item => {
                const checked = item.querySelector('input').checked;
                item.classList.toggle('selected', checked);
            });
        }

        function goToStep2() {
            if (selectedUnisForSend.length === 0) {
                alert('Please select at least one university!');
                return;
            }

            document.getElementById('sendStep1').style.display = 'none';
            document.getElementById('sendStep2').style.display = 'block';

            // Show selected universities
            const selectedList = document.getElementById('selectedUnisList');
            selectedList.innerHTML = selectedUnisForSend.map(u => 
                `<span style="display: inline-block; background: var(--bg-cream); padding: 0.35rem 0.75rem; border-radius: 50px; font-size: 0.85rem; margin: 0.25rem;">${u.name}</span>`
            ).join('');
        }

        function goToStep1() {
            document.getElementById('sendStep2').style.display = 'none';
            document.getElementById('sendStep1').style.display = 'block';
        }

        async function submitApplication() {
            const email = document.getElementById('confirmEmail').value;
            if (!email || !email.includes('@')) {
                alert('Please enter a valid email address!');
                return;
            }

            // Save applications
            selectedUnisForSend.forEach(uni => {
                sentApplications.push({
                    universityId: uni.id,
                    universityName: uni.name,
                    email: email,
                    submittedAt: new Date().toISOString(),
                    status: 'Pending',
                    documents: Object.keys(uploadedDocuments)
                });
            });

            localStorage.setItem('sentApplications', JSON.stringify(sentApplications));

            // Sync to backend
            const info = JSON.parse(localStorage.getItem('personalInfo') || '{}');
            if (info.phone && window.UserAPI && window.UserAPI.isValidPhoneNumber(info.phone)) {
                await syncToBackend();
            }

            // Show success
            document.getElementById('sendStep2').style.display = 'none';
            document.getElementById('sendStep3').style.display = 'block';
            document.getElementById('confirmedEmail').textContent = email;

            updateStats();
            loadApplications();
        }

        function quickSendToUni(uniId) {
            const uni = bookmarkedUniversities.find(u => u.id === uniId);
            if (uni) {
                selectedUnisForSend = [{ id: uni.id, name: uni.name }];
                openSendModal();
                // Auto-select this university
                setTimeout(() => {
                    const checkbox = document.querySelector(`[data-uni-id="${uniId}"] input`);
                    if (checkbox) {
                        checkbox.checked = true;
                        checkbox.dispatchEvent(new Event('change'));
                    }
                }, 100);
            }
        }

        // Close modal on outside click
        document.getElementById('sendModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSendModal();
            }
        });
    </script>
</body>
</html>
